<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Print Shop</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
        header { background-color: #333; color: white; padding: 1rem; text-align: center; }
        .container { padding: 20px; display: none; }
        .item { border: 1px solid #ddd; padding: 20px; margin-bottom: 20px; }
        .cart { margin-top: 20px; }
        button { padding: 10px 20px; background-color: #28a745; color: white; border: none; cursor: pointer; }
        button:disabled { background-color: #ccc; }
        .login-container { padding: 20px; }
        .login-container input { padding: 10px; margin: 5px; width: 100%; }
    </style>
</head>
<body>
    <header>
        <h1>3D Print Shop</h1>
        <p>Select items and customize your 3D prints</p>
    </header>

    <!-- Sign In/Up Page -->
    <div id="login" class="login-container">
        <h2>Sign In / Sign Up</h2>
        <input type="email" id="email" placeholder="Enter your email"><br>
        <input type="password" id="password" placeholder="Enter your password"><br>
        <button onclick="login()">Sign In / Sign Up</button>
        <p id="loginMessage"></p>
    </div>

    <!-- Shop Content -->
    <div class="container" id="shop">
        <h2>Available Items</h2>
        <div id="menu-items">
            <!-- Items from Google Sheet will load here -->
        </div>

        <h2>Custom 3D Print Order</h2>
        <div class="item">
            <label for="stlUpload">Upload STL file:</label>
            <input type="file" id="stlUpload" accept=".stl"><br><br>
            <label for="customColor">Color:</label>
            <select id="customColor">
                <option value="Red">Red</option>
                <option value="Blue">Blue</option>
                <option value="Green">Green</option>
            </select><br><br>
            <label for="customSize">Size:</label>
            <select id="customSize">
                <option value="Small">Small (25mm)</option>
                <option value="Medium">Medium (50mm)</option>
                <option value="Large">Large (100mm)</option>
            </select><br><br>
            <button id="addCustomToCart">Add Custom Print to Cart</button>
        </div>

        <div class="cart">
            <h2>Shopping Cart</h2>
            <div id="cartItems"></div>
            <button id="checkoutButton">Proceed to Checkout</button>
        </div>
    </div>

    <script>
        let cart = [];

        // Sign-In / Sign-Up Functionality
        function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (email && password) {
                localStorage.setItem('email', email);
                localStorage.setItem('password', password);
                document.getElementById('loginMessage').textContent = "Successfully logged in!";
                document.getElementById('login').style.display = 'none';
                document.getElementById('shop').style.display = 'block';
                loadMenuItems();
            } else {
                document.getElementById('loginMessage').textContent = "Please enter both email and password!";
            }
        }

        // Fetch items from Google Sheets
        function loadMenuItems() {
            fetch('https://spreadsheets.google.com/feeds/list/11-9VxCZfMXiFpmEy2LUsmHtHlF8sIu_FuAX8oz-zQyE/od6/public/values?alt=json')
                .then(response => response.json())
                .then(data => {
                    const items = data.feed.entry;
                    const menuItemsContainer = document.getElementById('menu-items');
                    menuItemsContainer.innerHTML = '';

                    items.forEach(item => {
                        const name = item.gsx$name.$t;
                        const price = item.gsx$price.$t;
                        const colors = item.gsx$colors.$t.split(',');
                        const sizes = item.gsx$sizes.$t.split(',');

                        const itemDiv = document.createElement('div');
                        itemDiv.classList.add('item');

                        const colorSelect = document.createElement('select');
                        colors.forEach(color => {
                            const option = document.createElement('option');
                            option.value = color;
                            option.textContent = color;
                            colorSelect.appendChild(option);
                        });

                        const sizeSelect = document.createElement('select');
                        ['Small (25mm)', 'Medium (50mm)', 'Large (100mm)'].forEach(size => {
                            const option = document.createElement('option');
                            option.value = size;
                            option.textContent = size;
                            sizeSelect.appendChild(option);
                        });

                        itemDiv.innerHTML = `
                            <h3>${name}</h3>
                            <p>Price: $${price}</p>
                        `;
                        itemDiv.appendChild(colorSelect);
                        itemDiv.appendChild(sizeSelect);

                        const addButton = document.createElement('button');
                        addButton.textContent = 'Add to Cart';
                        addButton.onclick = () => addToCart(name, price, colorSelect.value, sizeSelect.value);
                        itemDiv.appendChild(addButton);

                        menuItemsContainer.appendChild(itemDiv);
                    });
                });
        }

        // Add item to cart
        function addToCart(name, price, color, size) {
            cart.push({ name, price, color, size });
            updateCart();
        }

        // Update cart display
        function updateCart() {
            const cartItems = document.getElementById('cartItems');
            cartItems.innerHTML = '';

            cart.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.textContent = `${item.name} - $${item.price} - Color: ${item.color}, Size: ${item.size}`;
                cartItems.appendChild(itemDiv);
            });
        }

        // Custom print to cart
        document.getElementById('addCustomToCart').addEventListener('click', () => {
            const fileInput = document.getElementById('stlUpload');
            const color = document.getElementById('customColor').value;
            const size = document.getElementById('customSize').value;

            if (fileInput.files.length > 0) {
                const fileName = fileInput.files[0].name;
                addToCart('Custom 3D Print (' + fileName + ')', 'TBD', color, size);
            }
        });

        // Check if user is already logged in
        if (localStorage.getItem('email') && localStorage.getItem('password')) {
            document.getElementById('login').style.display = 'none';
            document.getElementById('shop').style.display = 'block';
            loadMenuItems();
        }
    </script>
</body>
</html>
